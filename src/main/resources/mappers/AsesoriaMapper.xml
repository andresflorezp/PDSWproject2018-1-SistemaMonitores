<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
                     
<mapper namespace="edu.eci.pdsw.sampleprj.dao.mybatis.mappers.AsesoriaMapper">
    <select parameterType="map" id="consultaAsesoriasMonitor" resultMap="AsesoriaResult">
        select 
        
            materia.materia_id,
            materia.materia_nombre as m_nombre,
            materia.materia_nemonico as m_nemonico,
            materia.creditos as m_creditos,
            materia.horas_monitoria_curso as m_horas_monitoria_curso,

            tema.temaid,
            tema.topic as tm_topic,
            tema.descripcion as tm_descripcion,

            grupo.grupoid,
            grupo.grupo_nombre as gr_grupo_nombre,
            grupo.numeroestudiante as gr_numeroestudiante,
            grupo.horario_monitor as gr_horario_monitor,

            profesor.profesorid,
            profesor.nombres as pr_nombres,
            profesor.apellidos as pr_apellidos,
            profesor.correo as pr_correo,
            profesor.telefono as pr_telefono,

            semestre.semestre_id,
            date_part('year',semestre."year") as se_year,
            semestre.periodo_academico as se_periodo_academico,
            semestre.fechainicio as se_fechainicio,
            semestre.fechafin as se_fechafin,

            monitor.codigo_id,
            monitor.nombres as mo_nombres,
            monitor.apellidos as mo_apellidos,
            monitor.correo as mo_correo,
            monitor.telefono as mo_telefono,
            monitor.semestreingreso as mo_semestreingreso,
            monitor.programa_academico as mo_programa_academico,

            asesoriamonitor.asesoriaid,
            asesoriamonitor.inicio_asesoria as asm_inicio_asesoria,
            asesoriamonitor.fin_asesoria as asm_fin_asesoria,
            asesoriamonitor.ip_asesoria as asm_ip_asesoria,
            asesoriamonitor.observaciones as asm_observaciones,

            estudiante.carnet,
            estudiante.nombre as es_nombre,
            estudiante.grupo as es_grupo
    
	from materia join grupo on (materia_id=grupo.materia_materia_id) 
	    left join semestre on (semestre.semestre_id=grupo.semestre_semestre_id)
	    left join monitor on (monitor.codigo_id=grupo.monitor_codigo_id)
	    left join profesor on (profesorid=profesor_profesor_id)
	    join asesoriamonitor on (monitor.codigo_id=asesoriamonitor.monitor_asesoria_id)
	    join asesoriaestudiante on (asesoriamonitor.asesoriaid=asesoriaestudiante.asesoria_monitor_asesoriaid)
	    left join estudiante on (estudiante.carnet=asesoriaestudiante.estudiante_carnet)
	    left join temamonitoria on (temamonitoria.asesoriaestudiante_asesoria_monitor_asesoriaid = asesoriaestudiante.asesoria_monitor_asesoriaid
	    					and temamonitoria.asesoriaestudiante_estudiante_carnet = asesoriaestudiante.estudiante_carnet)
	    left join tema on (temamonitoria.tema_temaid=tema.temaid)
        
        <where>
            <if test="MIn != null">
                materia.materia_nombre = #{MIn}
            </if>
            <if test="grn != null">
                AND grupo.grupo_nombre = #{grn}
            </if>
            <if test="frh != null">
                AND grupo.horario_monitor = #{frh}
            </if>
            <if test="tmTp != null">
                AND tema.topic = #{tmTp}
            </if>
            <if test="tmTp != null">
                AND tema.topic = #{numA}
            </if>
        </where>
	
    </select>
    
    <resultMap type="Asesoria" id="AsesoriaResult" >
        <id property="asesoriaID" column="asesoriaid"/>
        <result property="observaciones" column="asm_observaciones"/>
        <result property="fecha" column="asm_inicio_asesoria"/>
        <association property="grupo" javaType="Grupo" resultMap='edu.eci.pdsw.sampleprj.dao.mybatis.mappers.GrupoMapper.GrupoResult'/>
        <collection property="temas" ofType="Tema" resultMap='edu.eci.pdsw.sampleprj.dao.mybatis.mappers.TemaMapper.TemaResult'/>
        <collection property="asistentes" ofType="Estudiante" resultMap='edu.eci.pdsw.sampleprj.dao.mybatis.mappers.EstudianteMapper.EstudianteResult'/>
    </resultMap>
</mapper>
